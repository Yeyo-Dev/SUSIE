<div class="env-backdrop">
    <div class="env-card">
        <!-- Indicador de pasos din√°mico -->
        @if (steps().length > 0) {
        <susie-step-indicator [steps]="steps()" />
        }

        <header class="env-header">
            <div class="header-icon-container">
                <span class="header-icon">üõ°Ô∏è</span>
            </div>
            <h1>Verificaci√≥n de Entorno</h1>
            <p>Preparando tu sesi√≥n segura. Verificamos tus dispositivos autom√°ticamente.</p>

            <!-- Overall progress -->
            <div class="overall-progress">
                <div class="overall-bar">
                    <div class="overall-fill" [style.width.%]="isChecking() ? 50 : (hasErrors() ? 75 : 100)">
                    </div>
                </div>
                <span class="overall-label">
                    @if (isChecking()) { Verificando... }
                    @else if (hasErrors()) { Algunos fallos detectados }
                    @else { ¬°Todo listo! }
                </span>
            </div>
        </header>

        <div class="checks-container">
            @for (check of checks(); track check.id; let i = $index) {
            <div class="check-row" [class]="check.status" [style.animation-delay.ms]="i * 100">
                <div class="check-icon-wrapper">
                    <span class="check-icon" aria-hidden="true">{{ check.icon }}</span>
                    @if (check.status === 'success') {
                    <div class="status-badge success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                    </div>
                    } @else if (check.status === 'error') {
                    <div class="status-badge error">‚úï</div>
                    } @else if (check.status === 'checking') {
                    <div class="status-spinner"></div>
                    }
                </div>

                <div class="check-info">
                    <div class="check-title-row">
                        <h3>{{ check.label }}</h3>
                        @if (check.optional) { <span class="badge-optional">Opcional</span> }
                    </div>
                    <p class="check-status-msg">{{ check.message }}</p>
                </div>

                <!-- Status indicator line -->
                <div class="check-end-indicator">
                    @if (check.status === 'success') {
                    <span class="indicator-dot success"></span>
                    } @else if (check.status === 'error') {
                    <span class="indicator-dot error"></span>
                    } @else if (check.status === 'checking') {
                    <span class="indicator-dot checking"></span>
                    }
                </div>
            </div>
            }
        </div>

        <footer class="env-footer">
            @if (isChecking()) {
            <div class="footer-status checking">
                <div class="spinner-sm"></div>
                <span>Realizando comprobaciones...</span>
            </div>
            } @else if (hasErrors()) {
            <div class="footer-status error">
                <div class="error-alert">
                    <div class="error-alert-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="8" x2="12" y2="12" />
                            <line x1="12" y1="16" x2="12.01" y2="16" />
                        </svg>
                    </div>
                    <div>
                        <strong>Requisitos no cumplidos</strong>
                        <p>Por favor soluciona los problemas marcados para continuar.</p>
                    </div>
                </div>
                <button class="btn btn-retry" (click)="runChecks()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10" />
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                    </svg>
                    Reintentar
                </button>
            </div>
            } @else {
            <div class="success-footer">
                <div class="success-badge-row">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                        <polyline points="22 4 12 14.01 9 11.01" />
                    </svg>
                    <span>Todo verificado correctamente</span>
                </div>
                <button class="btn btn-primary" (click)="completeCheck()">
                    Continuar al Examen
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12" />
                        <polyline points="12 5 19 12 12 19" />
                    </svg>
                </button>
            </div>
            }
        </footer>
    </div>
</div>